# Gatsby with MDX

# üëã

## Hello MDX

Scott Spence ‚Ä¢ <span
style={{ color: '#663399' }}>UtkalHacks.tech</span>

<small>March 2021</small>

---

# Scott Spence

<Note>

- Been professional web a developer since 2018
- Analyst Developer 10 years previously
- Large financial organisations Braclays, Fidelity and Deloitte
- I'm married, I have a wife and Daughter and we live in Kent here in
  the UK

</Note>

---

<img
  style={{
    maxWidth: '100%',
    textAlign: 'center',
    display: 'inline',
  }}
  src="./assets/cat-dad.jpg"
/>

<Note>

- I'm a cat dad...
- That's Boris, Leo and Darcy

</Note>

---

<img src="./assets/karma-logo.svg" />

<Note>

- Ok, I work for an ad agency called Karmarama
- And I'm in the Creative Products business unit
- At this point we're pretty much a Government contractor with two
  large scale Gatsby projects in production
- None of which I have worked on or can talk about because, NDA
- I'm not here to talk about any of that
- Sooo, moving on!

</Note>

---

## Progressive Disclosure of Complexity

[jason.af/progressive-disclosure-of-complexity]

[jason.af/progressive-disclosure-of-complexity]:
  https://www.jason.af/progressive-disclosure-of-complexity

<Note>

- In this workshop I'll be going though the different aspects of the
  individual technologies used.
- Then ramping up as I go along.
- Shout out to Jason Lengstorf for introducing me to this concept.
- Let's take a look at the agenda.

</Note>

---

# Agenda

<!-- prettier-ignore-start -->
<Grid
  gridTemplateColumns={["25% ‚Äãauto 10% 20%", "25% auto 10% 20%", "25% ‚Äãauto 10% 20%"]}
  gridTemplateRows="100%"
  gridTemplateAreas=". main logos ."
>
<Step styles={{
  before: {opacity: 0},
  after:  {opacity: 1, transition: 'all 0.2s ease-out'}
}}
as='Flex' gridArea="main" flexFlow="column nowrap" justifyContent="space-evenly" height="100%"
sx={{'& p': {textAlign: 'left', m: 0, lineHeight: 'small', minHeight: '5%'}}}
>

What is __Markdown__

__What__ is MDX

__Why__ Gatsby

__Build__

</Step>

<Step styles={{
  base:     {height: '5%', transition: 'all 0.2s ease-in-out'},
  before:   {opacity: 0},
  after:    {opacity: 1},
  current:  {transform: 'scale(1.7)'},
}}
as='Flex' gridArea="logos" flexFlow="column nowrap" justifyContent="space-evenly" height="100%"
>

![Markdown](./assets/markdown.svg)

![What](./assets/mdx-logo.svg)

![Why](./assets/gatsby.svg)

![Build](./assets/build.svg)

</Step>
</Grid>

<!-- prettier-ignore-end -->

<Note>

- What is Markdown
- What is MDX
- Why Gatsby
- Build a Gatsby site with MDX
- Ok, so - first up!

</Note>

---

# Bonus

<div sx={{display: 'flex'}}>
  
  <img src="./assets/graphcms-logo.svg" width="100" />
  <img src="./assets/mdx-logo.svg" width="200" />

</div>

GraphCMS with MDX

<Note>

- Bonus round time permitting
- Use GraphCMS blog template for content with MDX components

</Note>

---

# What is Markdown?

# ü§î

<Note>

- If you're not familiar with Markdown it's a way to enable simple
  editing in plain text files that can be converted to HTML.
- fun fact, this presentation is written in Markdown with JSX, more on
  that later though

</Note>

---

<iframe
  src="https://daringfireball.net/projects/markdown/"
  title="Markdown creation"
  width="50%"
  height="50%"
  style={{
    border: 'none',
    transform: 'scale(1.5)',
  }}
/>

<Note>

- Markdown has been around since 2004, here's the original post from
  John Gruber on Daring Fireball

</Note>

---

# Markdown Showdown

Interactive guide: [ss10.dev/mdsd]

[ss10.dev/mdsd]: https://ss10.dev/mdsd

<Note>

- I did a talk on Markdown you can check it out at ss10.dev/mdsd
- Quick example of using Markdown would be

</Note>

---

<CodeHighlight>

```md
# Hello world

This is a paragraph
```

<Note>

- This would be in your text editor
- Then that would render to

</Note>

</CodeHighlight>

---

# Hello world

This is a paragraph

<Note>

- This
- As I mentioned earlier this presentation is written in Markdown
- Ok, next up MDX

</Note>

---

# What is MDX?

# ü§î

<Note>

- MDX is the next step with Markdown
- MDX is Markdown and JSX
- JSX being the HTML elements in React
- It allows you to add interactive components to your documentation

</Note>

---

<img
  style={{
    maxWidth: '50%',
    textAlign: 'center',
    display: 'inline',
  }}
  src="./assets/mdx-logo.svg"
/>

## [mdxjs.com/conf]

[mdxjs.com/conf]: https://mdxjs.com/conf

<Note>

- Last year was the first MDX conf
- Check out MDX conf

</Note>

---

# Why Gatsby

<Note>

- Gatsby _is_ a static site generator, so there's no dynamic
  generation of pages when the pages are requested. The built output
  for a Gatsby site can be hosted on a CDN making it globally
  available and super scalable.
- Gatsby can use Markdown files to create pages in a site project.
  Gatsby will read the Markdown files into the Gatsby filesystem and
  transform the Markdown to HTML and then when building the site
  create static pages.
- The end result is a super fast site with little latency when
  requesting the pages.

</Note>

---

# Build

<Note>

- I'm going to build a Gatsby blog now

</Note>

---

<CodeHighlight>

## Install dependencies!

```bash
#  bash
yarn add gatsby react react-dom
```

<Note>

- First up to install what I need to get started

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Create files and folders!

```bash
# -p is to create parent directories too if needed
mkdir -p src/pages
# create the index (home) page
touch src/pages/index.js
```

<Note>

- Now to create the basic files structure for the project
- Note `src/pages/index.js` is the Gatsby folder structure

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Create files and folders!

```jsx
// index.js
import React from 'react'

export default function IndexPage() {
  return <h1>Hello World!</h1>
}
```

<Note>

- Now I'll add in the site index page

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Run Gatsby develop!

```bash
# if you're using npm üëá
# $(npm bin)/gatsby develop
yarn gatsby develop
```

<Note>

- yarn gatsby develop to run from the terminal without npm
- I'll add in some scripts next

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Add npm scripts!

```json
// package.json
"scripts": {
  "build": "gatsby build",
  "dev": "gatsby develop -p 8945 -o",
  "serve": "gatsby serve -p 9854 -o",
  "clean": "gatsby clean"
},
```

<Note>

- The default port for Gatsby develop is 8000 I've specified my port
  with the `-p` flag
- The `-o` flag opens the web page when it's ready

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Create content files for the blog!

```bash
# this creates the folders in the root of the project
mkdir -p content/2021/03/{06/hello-world,07/second-post,08/third-post}
# create individual files
touch content/2021/03/06/hello-world/index.mdx
touch content/2021/03/07/second-post/index.mdx
touch content/2021/03/08/third-post/index.mdx
```

<Note>

- Create .mdx files from the terminal
- Becuse watching someone do it isn't very entertaining

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Add content!

```markdown
---
title: Hello World - from mdx!
date: 2021-03-06
---

My first post!!

## h2 Heading

Some meaningful prose

### h3 Heading

Some other meaningful prose
```

<Note>

- I'll add the content for the other files too
- Note the frontmatter block `---` this is the data about the post

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Create Gatsby config

```bash
touch gatsby-config.js
# add required Gatsby plugins
yarn add gatsby-plugin-mdx @mdx-js/mdx @mdx-js/react gatsby-source-filesystem
```

<Note>

- Create the Gatsby config file to take the plugins
- Install the plugins needed

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Config the config üòÇ

```js
module.exports = {
  plugins: [
    `gatsby-plugin-mdx`,
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        path: `${__dirname}/content`,
        name: `content`,
      },
    },
  ],
}
```

<Note>

- Gatsby source filesystem pointed to the content
- Add the MDX plugin to parse the MDX files

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Add site metadata

```js
const siteMetadata = {
  title: `My Gatsby Blog`,
  description: `This is my coding blog.`,
}
module.exports = {
  siteMetadata,
  plugins: [
    // configured plugins here
    {
      // empty for brevity
    },
  ],
}
```

<Note>

- `siteMetadata` in it's own object for ease of management
- This is important for SEO

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Gatsby GraphQL explorer

```bash
You can now view my-gatsby-blog in the browser.
‚†Ä
  http://localhost:8000/
‚†Ä
View GraphiQL, an in-browser IDE, to explore your site's data and schema
‚†Ä
  http://localhost:8000/___graphql
```

<Note>

- You may have noticed this in the terminal
- Now I can check on the data with Graph<em>i</em>QL

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Gatsby Graph<em>i</em>QL explorer

```graphql
{
  allMdx {
    nodes {
      frontmatter {
        title
        date
      }
    }
  }
}
```

<Note>

- Add a query to get the frontmatter of the posts
- The resulting data looks like this, next slide

</Note>

</CodeHighlight>

---

<CodeHighlight>

```json
{
  "data": {
    "allMdx": {
      "nodes": [
        {
          "frontmatter": {
            "title": "Hello World - from mdx!",
            "date": "2021-03-06T00:00:00.000Z"
          }
        }
      ]
    }
  }
}
```

<Note>

- I can use this in a react component now
- Other results removed for brevity

</Note>

</CodeHighlight>

---

<CodeHighlight>

## Site metadata hook files

```bash
# make a folder for all the hooks to live
mkdir src/hooks
# creathe the file
touch src/hooks/use-site-metadata.js
```

<Note>

- I'm creating a hook to get the siteMetadata
- Next slide for the hook

</Note>

</CodeHighlight>

---

<CodeHighlight>

```jsx
// src/hooks/use-site-metadata.js
import { graphql, useStaticQuery } from 'gatsby'
export const useSiteMetadata = () => {
  const { site } = useStaticQuery(
    graphql`
      query SITE_METADATA_QUERY {
        site {
          siteMetadata {
            title
            description
          }
        }
      }
    `
  )
  return site.siteMetadata
}
```

<Note>

- I'm creating a hook to get the siteMetadata

</Note>

</CodeHighlight>

---

<CodeHighlight>

```diff
+ query SITE_METADATA_QUERY {
  site {
    siteMetadata {
      title
      description
    }
  }
}
```

<Note>

- You may notice the query looks different
- This is to help with identification because there will be more
  queries in the project

</Note>

</CodeHighlight>

---

<CodeHighlight>

# Implement `siteMetadata` hook

```jsx {3,5,8-9}
// src/pages/index.js
import React from 'react'
import { useSiteMetadata } from '../hooks/use-site-metadata'
export default function IndexPage() {
  const { title, description } = useSiteMetadata()
  return (
    <>
      <h1>{title}</h1>
      <p>{description}</p>
    </>
  )
}
```

<Note>

- Use the siteMetadata hook in the index page

</Note>

</CodeHighlight>

---

<CodeHighlight>

# Add Theme UI

```bash
yarn add theme-ui gatsby-plugin-theme-ui @theme-ui/presets
```

<Note>

- Install dependencies for Theme UI

</Note>

</CodeHighlight>

---

<CodeHighlight>

# Gatsby config Theme UI

```js {4}
module.exports = {
  siteMetadata,
  plugins: [
    `gatsby-plugin-theme-ui`,
    `gatsby-plugin-mdx`,
    {
      resolve: `gatsby-source-filesystem`,
    },
    // rest of the module unchanged
  ],
}
```

<Note>

- Add the Theme UI

</Note>

</CodeHighlight>

---

<CodeHighlight>

# Theme UI files

```bash
# create the folder for the Theme UI theme
mkdir src/gatsby-plugin-theme-ui
# create the theme file
touch src/gatsby-plugin-theme-ui/index.js
```

<Note>

- Create files for Theme UI

</Note>

</CodeHighlight>

---

<CodeHighlight>

# Gatsby config Theme UI

```js
import { deep, swiss } from '@theme-ui/presets'

const theme = {
  ...swiss,
}

export default theme
```

<Note>

- Spread in the preset

</Note>

</CodeHighlight>

---

<CodeHighlight>

# Set up Dark Theme

```js
const theme = {
  ...swiss,
  colors: {
    ...swiss.colors,
    modes: {
      dark: {
        ...deep.colors,
      },
    },
  },
}
```

<Note>

- Spread deep theme into color mode

</Note>

</CodeHighlight>

---

<div style={{transform: 'scale(0.75)'}}>

<CodeHighlight>

```js
import { deep, swiss } from '@theme-ui/presets'

const theme = {
  ...swiss,
  colors: {
    ...swiss.colors,
    modes: {
      dark: {
        ...deep.colors,
      },
    },
  },
  styles: {
    ...swiss.styles,
    p: {
      fontFamily: 'body',
      fontWeight: 'body',
      lineHeight: 'body',
      fontSize: 3,
    },
  },
}

export default theme
```

</CodeHighlight>

</div>

<Note>

- Full file looks like this
- From here on the code samples will be getting harder to show in a
  slide

</Note>

---

<CodeHighlight>

# Layout component

```bash
# create a components folder
mkdir src/components
# create Layout and Header files
touch src/components/header.js src/components/layout.js
```

<Note>

- Creating a header and layout component

</Note>

</CodeHighlight>

---

<div style={{transform: 'scale(0.65)'}}>

<CodeHighlight>

```jsx
// src/components/header.js
import { Link as GatsbyLink } from 'gatsby'
import React from 'react'
import { Box, Heading, Link } from 'theme-ui'

export const Header = ({ siteTitle, siteDescription }) => {
  return (
    <Box as="header" sx={{ bg: 'highlight', mb: '1.45rem' }}>
      <Box
        as="div"
        sx={{
          m: '0 auto',
          maxWidth: '640px',
          p: '1.45rem 1.0875rem',
        }}
      >
        <Link as={GatsbyLink} to="/">
          <Heading>{siteTitle}</Heading>
        </Link>
        <Box as="p" variant="styles.p">
          {siteDescription}
        </Box>
      </Box>
    </Box>
  )
}
```

</CodeHighlight>

</div>

<Note>

- Create a header component to take site title and description from
  the `useSiteMetadata` hook
- I'll use `useSiteMetadata` in the layout component

</Note>

---

<div style={{transform: 'scale(0.65)'}}>

<CodeHighlight>

```jsx
import React from 'react'
import { Box } from 'theme-ui'
import { useSiteMetadata } from '../hooks/use-site-metadata'
import { Header } from './header'

export const Layout = ({ children }) => {
  const { title, description } = useSiteMetadata()
  return (
    <>
      <Header siteTitle={title} siteDescription={description} />
      <Box
        as="div"
        sx={{
          margin: '0 auto',
          maxWidth: '640px',
          padding: '0 1.0875rem 1.45rem',
        }}
      >
        <Box as="main">{children}</Box>
      </Box>
    </>
  )
}
```

</CodeHighlight>

</div>

<Note>

- The layout component will wrap everything in the site

</Note>

---

<CodeHighlight>

# Implement Layout component

```jsx {7,9}
import React from 'react'
import { Layout } from '../components/layout'

export default function IndexPage() {
  return (
    <>
      <Layout>
        <h1>This is wrapped</h1>
      </Layout>
    </>
  )
}
```

<Note>

- Creating a header and layout component

</Note>

</CodeHighlight>

---

<CodeHighlight>

# Query site content for index page

```graphql
{
  allMdx(sort: { fields: [frontmatter___date], order: DESC }) {
    nodes {
      id
      slug
      excerpt(pruneLength: 250)
      frontmatter {
        title
        date(formatString: "YYYY MMMM Do")
      }
    }
  }
}
```

<Note>

- Creating a header and layout component

</Note>

</CodeHighlight>

---

<div style={{transform: 'scale(0.3)'}}>

<CodeHighlight>

```jsx
// src/pages/index.js
import { graphql, Link as GatsbyLink } from 'gatsby'
import React from 'react'
import { Box, Heading, Link } from 'theme-ui'
import { Layout } from '../components/layout'

export default function IndexPage({ data }) {
  return (
    <>
      <Layout>
        {data.allMdx.nodes.map(
          ({ id, excerpt, frontmatter, slug }) => (
            <Box
              key={id}
              as="article"
              sx={{
                mb: 4,
                p: 3,
                boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)',
                border: '1px solid #d1d1d1',
                borderRadius: '15px',
              }}
            >
              <Link as={GatsbyLink} to={`/${slug}`}>
                <Heading>{frontmatter.title}</Heading>
                <Box as="p" variant="styles.p">
                  {frontmatter.date}
                </Box>
                <Box as="p" variant="styles.p">
                  {excerpt}
                </Box>
              </Link>
            </Box>
          )
        )}
      </Layout>
    </>
  )
}

export const query = graphql`
  query SITE_INDEX_QUERY {
    allMdx(sort: { fields: [frontmatter___date], order: DESC }) {
      nodes {
        id
        excerpt(pruneLength: 250)
        frontmatter {
          title
          date(formatString: "YYYY MMMM Do")
        }
        slug
      }
    }
  }
`
```

</CodeHighlight>

</div>

<Note>

- See what I mean about getting harder to display the components now!
- Let me try break it down a bit

</Note>

---

<CodeHighlight>

# Index query

```graphql
query SITE_INDEX_QUERY {
  allMdx(sort: { fields: [frontmatter___date], order: DESC }) {
    nodes {
      id
      excerpt(pruneLength: 250)
      frontmatter {
        title
        date(formatString: "YYYY MMMM Do")
      }
      slug
    }
  }
}
```

<Note>

- This is getting all the mdx posts in date order

</Note>

</CodeHighlight>

---

<div style={{transform: 'scale(0.5)'}}>

<CodeHighlight>

# Layout wrapping the index query

```jsx
<Layout>
  {data.allMdx.nodes.map(({ id, excerpt, frontmatter, slug }) => (
    <Box
      key={id}
      as="article"
      sx={{
        mb: 4,
        p: 3,
        boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)',
        border: '1px solid #d1d1d1',
        borderRadius: '15px',
      }}
    >
      <Link as={GatsbyLink} to={`/${slug}`}>
        <Heading>{frontmatter.title}</Heading>
        <Box as="p" variant="styles.p">
          {frontmatter.date}
        </Box>
        <Box as="p" variant="styles.p">
          {excerpt}
        </Box>
      </Link>
    </Box>
  ))}
</Layout>
```

</CodeHighlight>

</div >

<Note>

- This is the imported layout component wrapping the posts from the
  query with Them UI components

</Note>

---

<CodeHighlight>

# Gatsby File Routes API

```jsx
# create the route api file
touch src/pages/{mdx.slug}.js
```

<Note>

- Clicking on the links in the index page won't give anything just yet
  as I've not created the pages for that
- I'll do that now with the Gatsby file routes api
- Note the file notation

</Note>

</CodeHighlight>

---

<div style={{transform: 'scale(0.45)'}}>

<CodeHighlight>

# `{mx.slug}.js`

```jsx
// src/pages/{mdx.slug}.js
import { graphql } from 'gatsby'
import { MDXRenderer } from 'gatsby-plugin-mdx'
import React from 'react'
import { Box } from 'theme-ui'
export default function PostPage({ data }) {
  const {
    body,
    frontmatter: { title },
  } = data.mdx
  return (
    <>
      <Box as="h1" variant="styles.h1" fontSize="4xl">
        {title}
      </Box>
      <MDXRenderer>{body}</MDXRenderer>
    </>
  )
}

export const query = graphql`
  query POST_BY_SLUG($slug: String) {
    mdx(slug: { eq: $slug }) {
      id
      slug
      body
      frontmatter {
        date
        title
      }
    }
  }
`
```

</CodeHighlight>

</div >

<Note>

- This is the imported layout component wrapping the posts from the
  query with Them UI components

</Note>

---

<CodeHighlight>

# `{mdx.slug}.js` query

```graphql {2,4}
query POST_BY_SLUG($slug: String) {
  mdx(slug: { eq: $slug }) {
    id
    slug
    body
    frontmatter {
      date
      title
    }
  }
}
```

<Note>

- Uses the `mdx.slug` to create the page

</Note>

</CodeHighlight>

---

---

---

# GraphCMS with MDX

---

# Thanks üôè
